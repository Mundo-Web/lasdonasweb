import{j as s}from"./Example-zgwdEd5i.js";import{r as f,R}from"./useOutsideClick-TT1qJ6UJ.js";import{a as G}from"./axios-_sX4vCAy.js";import{s as M}from"./storage-zp2nPsZU.js";import{S as q}from"./Profile-6kVS_QzG.js";import{t as Z}from"./tippy.esm-vXDZ6XwW.js";import{r as V}from"./index-38suPYpT.js";const ee=async(t,e=!1)=>{try{const r=await G.post("/api/products/addComplemento",{id:t});if(r.status===200){const{data:n}=r.data;let a=n.map(o=>{var m;const u={id:o.id,producto:o.producto,precio:o.descuento>0?o.descuento:o.precio,imagen:((m=o.images.filter(w=>w.caratula===1)[0])==null?void 0:m.name_imagen)??"/images/img/noimagen.jpg",cantidad:1,sku:o.sku,tipo:"Complemento",fecha:"",horario:"",extract:o.extract};return o.tipo_servicio=="complemento"&&o.puntos_complemento>0&&(u.points=o.puntos_complemento,u.usePoints=e),u}),i=M.Local.get("carrito")??[];i.some(o=>o.id===a[0].id)?i=i.map(o=>o.id===a[0].id?{...o,cantidad:o.cantidad+Number(a[0].cantidad)}:o):i=[...i,a[0]],M.Local.set("carrito",i);const d=document.getElementById("open-cart"),c=$("#gift-icon");return c.addClass("send-to-cart"),setTimeout(()=>{c.removeClass("send-to-cart"),c.removeAttr("style"),limpiarHTML(),PintarCarrito(),$(d).addClass("shake"),setTimeout(function(){$(d).removeClass("shake")},1e3)},1e3),i}}catch(r){console.error(r),Swal.fire({icon:"error",title:"Error",text:"Hubo un error al agregar el pedido. Por favor, int√©ntelo de nuevo."})}};function K(t,e){if(t==null)return{};var r={},n=Object.keys(t),a,i;for(i=0;i<n.length;i++)a=n[i],!(e.indexOf(a)>=0)&&(r[a]=t[a]);return r}var J=typeof window<"u"&&typeof document<"u";function L(t,e){t&&(typeof t=="function"&&t(e),{}.hasOwnProperty.call(t,"current")&&(t.current=e))}function W(){return J&&document.createElement("div")}function te(t){var e={"data-placement":t.placement};return t.referenceHidden&&(e["data-reference-hidden"]=""),t.escaped&&(e["data-escaped"]=""),e}function Q(t,e){if(t===e)return!0;if(typeof t=="object"&&t!=null&&typeof e=="object"&&e!=null){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var r in t)if(e.hasOwnProperty(r)){if(!Q(t[r],e[r]))return!1}else return!1;return!0}else return!1}function re(t){var e=[];return t.forEach(function(r){e.find(function(n){return Q(r,n)})||e.push(r)}),e}function ne(t,e){var r,n;return Object.assign({},e,{popperOptions:Object.assign({},t.popperOptions,e.popperOptions,{modifiers:re([].concat(((r=t.popperOptions)==null?void 0:r.modifiers)||[],((n=e.popperOptions)==null?void 0:n.modifiers)||[]))})})}var B=J?f.useLayoutEffect:f.useEffect;function oe(t){var e=f.useRef();return e.current||(e.current=typeof t=="function"?t():t),e.current}function U(t,e,r){r.split(/\s+/).forEach(function(n){n&&t.classList[e](n)})}var ae={name:"className",defaultValue:"",fn:function(e){var r=e.popper.firstElementChild,n=function(){var d;return!!((d=e.props.render)!=null&&d.$$tippy)};function a(){e.props.className&&!n()||U(r,"add",e.props.className)}function i(){n()&&U(r,"remove",e.props.className)}return{onCreate:a,onBeforeUpdate:i,onAfterUpdate:a}}};function se(t){function e(r){var n=r.children,a=r.content,i=r.visible,p=r.singleton,d=r.render,c=r.reference,o=r.disabled,u=o===void 0?!1:o,m=r.ignoreAttributes,w=m===void 0?!0:m;r.__source,r.__self;var T=K(r,["children","content","visible","singleton","render","reference","disabled","ignoreAttributes","__source","__self"]),g=i!==void 0,x=p!==void 0,C=f.useState(!1),j=C[0],A=C[1],F=f.useState({}),y=F[0],X=F[1],D=f.useState(),Y=D[0],P=D[1],h=oe(function(){return{container:W(),renders:1}}),k=Object.assign({ignoreAttributes:w},T,{content:h.container});g&&(k.trigger="manual",k.hideOnClick=!1),x&&(u=!0);var S=k,I=k.plugins||[];d&&(S=Object.assign({},k,{plugins:x&&p.data!=null?[].concat(I,[{fn:function(){return{onTrigger:function(_,O){var E=p.data.children.find(function(N){var b=N.instance;return b.reference===O.currentTarget});_.state.$$activeSingletonInstance=E.instance,P(E.content)}}}}]):I,render:function(){return{popper:h.container}}}));var H=[c].concat(n?[n.type]:[]);return B(function(){var v=c;c&&c.hasOwnProperty("current")&&(v=c.current);var l=t(v||h.ref||W(),Object.assign({},S,{plugins:[ae].concat(k.plugins||[])}));return h.instance=l,u&&l.disable(),i&&l.show(),x&&p.hook({instance:l,content:a,props:S,setSingletonContent:P}),A(!0),function(){l.destroy(),p==null||p.cleanup(l)}},H),B(function(){var v;if(h.renders===1){h.renders++;return}var l=h.instance;l.setProps(ne(l.props,S)),(v=l.popperInstance)==null||v.forceUpdate(),u?l.disable():l.enable(),g&&(i?l.show():l.hide()),x&&p.hook({instance:l,content:a,props:S,setSingletonContent:P})}),B(function(){var v;if(d){var l=h.instance;l.setProps({popperOptions:Object.assign({},l.props.popperOptions,{modifiers:[].concat((((v=l.props.popperOptions)==null?void 0:v.modifiers)||[]).filter(function(_){var O=_.name;return O!=="$$tippyReact"}),[{name:"$$tippyReact",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(O){var E,N=O.state,b=(E=N.modifiersData)==null?void 0:E.hide;(y.placement!==N.placement||y.referenceHidden!==(b==null?void 0:b.isReferenceHidden)||y.escaped!==(b==null?void 0:b.hasPopperEscaped))&&X({placement:N.placement,referenceHidden:b==null?void 0:b.isReferenceHidden,escaped:b==null?void 0:b.hasPopperEscaped}),N.attributes.popper={}}}])})})}},[y.placement,y.referenceHidden,y.escaped].concat(H)),R.createElement(R.Fragment,null,n?f.cloneElement(n,{ref:function(l){h.ref=l,L(n.ref,l)}}):null,j&&V.createPortal(d?d(te(y),Y,h.instance):a,h.container))}return e}var ie=function(t,e){return f.forwardRef(function(n,a){var i=n.children,p=K(n,["children"]);return R.createElement(t,Object.assign({},e,p),i?f.cloneElement(i,{ref:function(c){L(a,c),L(i.ref,c)}}):null)})},ce=ie(se(Z));const z=ce,le=({onChange:t,...e})=>{const n=(Local.get("carrito")??[]).findIndex(a=>a.id==e.id)!=-1;return s.jsxs("div",{className:"m-auto w-full max-w-48",children:[s.jsx("label",{htmlFor:`react-option-${e.id}`,className:"flex items-center justify-between bg-white rounded-lg cursor-pointer shadow-md border w-full",children:s.jsxs("div",{className:"block w-full relative z-0",children:[s.jsx("input",{type:"checkbox",id:`react-option-${e.id}`,name:"complementos[]",className:`peer absolute top-3 left-3 w-5 h-5 border-orange-400  accent-rosalasdonasborder-orange-400 checked:border-orange-400  outline-orange-400 checked:bg-orange-400 hover:checked:bg-orange-400 hover:border-orange-400 hover:bg-orange-400
                               focus:border-orange-400 rounded-md shadow-md focus:checked:bg-orange-400 focus:checked:border-orange-400  focus:bg-orange-400`,required:!0,defaultChecked:n,onChange:a=>t(a,e.id,e)}),e.images.length>0?e.images.map(a=>a.caratula===1?s.jsx("img",{className:"w-full aspect-square rounded-lg object-cover",src:a.name_imagen?`/${a.name_imagen}`:"/images/img/noimagen.jpg",alt:e.producto},a.id):null):s.jsx("img",{className:"w-full aspect-square rounded-lg object-cover",src:"/images/img/noimagen.jpg",alt:"No imagen"}),e.puntos_complemento>0&&s.jsx(z,{content:`Tambien puedes cambiarlo por ${e.puntos_complemento} puntos`,children:s.jsxs("span",{className:"absolute bg-orange-400 right-2 bottom-2 text-sm px-2 pt-[2px] rounded-md text-white",children:[s.jsx("i",{className:"mdi mdi-dots-hexagon me-1"}),s.jsx("span",{children:e.puntos_complemento})]})})]})}),s.jsx(z,{content:e.producto,children:s.jsx("h2",{className:"text-base font-normal text-black text-center truncate w-full mt-2 mb-1",children:e.producto})}),s.jsx("div",{className:"flex items-center font-medium justify-center gap-3",children:e.descuento>0?s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"line-through text-gray-400 text-xs sm:text-sm",children:["S/ ",s.jsx("span",{children:e.precio})]}),s.jsxs("p",{children:["S/ ",e.descuento]})]}):s.jsxs("p",{children:["S/ ",e.precio]})})]})},de=t=>{let r=(Local.get("carrito")||[]).map(n=>(n.id===t&&n.cantidad>0&&(n.cantidad-=1),n));return Local.set("carrito",r),limpiarHTML(),PintarCarrito(),r},ue=({id:t,setDetallePedido:e,onChange:r,setCarrito:n=()=>{}})=>{const[a,i]=f.useState([]),[p,d]=f.useState(!0);if(f.useEffect(()=>{(async()=>{try{const u=await G.post("/buscaSubComplementosDetalle",{id:t});i(u.data.productos),d(!1)}catch(u){console.error("Error fetching data:",u),d(!1)}})()},[t]),p)return s.jsx("div",{children:"Loading..."});const c=async(o,u,m)=>{const w=Number($('[data-id="txt-user-points"]').text())||0;if((Local.get("carrito")??[]).length>0)if(o.target.checked){let g=!1;w>=m.puntos_complemento&&m.puntos_complemento>0&&(g=(await q.fire({title:"Deseas intercambiarlo con puntos?",text:"Si, usar puntos",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",confirmButtonColor:"#336234",cancelButtonColor:"#EF4444"})).isConfirmed);let x=await ee(u,g);n(x)}else de(u);else{const g=structuredClone(detallePedido),x=g.complementos.findIndex(j=>j.id===u);let C={};if(x===-1){let j=!1;w>=m.puntos_complemento&&m.puntos_complemento>0&&(j=(await q.fire({title:"Deseas intercambiarlo con puntos?",text:"Si, usar puntos",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",confirmButtonColor:"#336234",cancelButtonColor:"#EF4444"})).isConfirmed),C={...g,complementos:[...g.complementos,{...m,usePoints:j}]}}else C={...g,complementos:g.complementos.filter(j=>j.id!==u)};e(C)}};return s.jsx("div",{className:"grid w-full gap-4 grid-cols-1 md:grid-cols-4 mt-6",children:a.map(o=>s.jsx(le,{...o,onChange:c}))})},xe=({datos:t,setDetallePedido:e,setCarrito:r=()=>{}})=>{const[n,a]=f.useState(null),[i,p]=f.useState([]),d=c=>{n===c?a(null):(a(c),i.includes(c)||p([...i,c]))};return f.useEffect(()=>{d(0)},[null]),s.jsx("div",{children:t.map((c,o)=>s.jsxs("div",{className:"mt-3",children:[s.jsx("h2",{id:`accordion-collapse-heading-${c.id}`,className:"gap-4 flex flex-col",children:s.jsxs("button",{className:`flex items-center justify-between w-full p-5 font-medium rounded-t-xl  dark:focus:ring-gray-800 dark:border-gray-700 dark:text-black hover:bg-gray-100 bg-[#F8F8F8] dark:hover:bg-gray-800 gap-3 ${n===o?"bg-[#FF8555] text-white":"text-black rounded-b-xl"}`,"data-accordion-target":`#accordion-collapse-body-${c.id}`,"aria-expanded":n===o,"aria-controls":`accordion-collapse-body-${c.id}`,type:"button",style:{transition:"all 500ms ease-in-out"},onClick:()=>d(o),children:[s.jsx("span",{children:c.name}),s.jsx("svg",{"data-accordion-icon":"",className:`w-3 h-3 shrink-0 ${n===o?"stroke-[#FF8555]":"rotate-180 text-[#FF8555]"} `,fill:"none",viewBox:"0 0 10 6",children:s.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5 5 1 1 5"})})]})}),s.jsx("div",{id:`accordion-collapse-body-${c.id}`,className:`${n===o?"":"hidden"}`,"aria-labelledby":`accordion-collapse-heading-${c.id}`,children:s.jsx("div",{className:"p-5 border border-gray-200 dark:border-gray-700 dark:bg-gray-900 rounded-b-xl",children:i.includes(o)&&s.jsx(ue,{id:c.id,setDetallePedido:e,setCarrito:r})})})]},c.id))})};export{xe as A,le as C,z as T,ee as a,de as d};
