var C=Object.defineProperty;var F=(i,a,l)=>a in i?C(i,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[a]=l;var m=(i,a,l)=>(F(i,typeof a!="symbol"?a+"":a,l),l);import{j as e}from"./Example-zgwdEd5i.js";import{r as g}from"./useOutsideClick-TT1qJ6UJ.js";import{c as N}from"./ReactAppend-mx8-aehl.js";import{r as b}from"./server.browser-HbquNPx_.js";import{M as _}from"./ClasicModal-peLy3-GT.js";import{m as d}from"./main-Vi8adC25.js";import{S}from"./Profile-6kVS_QzG.js";import{C as k}from"./CreateReactScript-byan57Y_.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./index-38suPYpT.js";import"./index-VFMbf6KQ.js";import"./index-XJuWVQ-l.js";import"./storage-zp2nPsZU.js";import"./CreateReactScript-MHkScKtm.js";import"./axios-_sX4vCAy.js";/* empty css              */const E=({gridRef:i,rest:a,columns:l,toolBar:n,masterDetail:t,filterValue:x,exportable:h,exportableName:u,customizeCell:p=()=>{}})=>(g.useEffect(()=>{DevExpress.localization.locale(navigator.language),$(i.current).dxDataGrid({language:"es",dataSource:{load:async r=>await a.paginate({...r,_token:$('[name="csrf_token"]').attr("content")})},onToolbarPreparing:r=>{const{items:s}=r.toolbarOptions;n(s)},remoteOperations:!0,columnResizingMode:"widget",allowColumnResizing:!0,allowColumnReordering:!0,columnAutoWidth:!0,scrollbars:"auto",filterPanel:{visible:!0},searchPanel:{visible:!0},headerFilter:{visible:!0,search:{enabled:!0}},height:"calc(100vh - 185px)",filterValue:x,export:{enabled:h},onExporting:function(r){var s=new ExcelJS.Workbook,c=s.addWorksheet("Main sheet");DevExpress.excelExporter.exportDataGrid({worksheet:c,component:r.component,customizeCell:function(o){p(o),o.excelCell.alignment={horizontal:"left",vertical:"top",...o.excelCell.alignment}}}).then(function(){s.xlsx.writeBuffer().then(function(o){saveAs(new Blob([o],{type:"application/octet-stream"}),`${u}.xlsx`)})})},rowAlternationEnabled:!0,showBorders:!0,filterRow:{visible:!0,applyFilter:"auto"},filterBuilderPopup:{visible:!1,position:{of:window,at:"top",my:"top",offset:{y:10}}},paging:{pageSize:10},pager:{visible:!0,allowedPageSizes:[5,10,25,50,100],showPageSizeSelector:!0,showInfo:!0,showNavigationButtons:!0},allowFiltering:!0,scrolling:{mode:"standard",useNative:!0,preloadEnabled:!0,rowRenderingMode:"standard"},columnChooser:{title:"Mostrar/Ocultar columnas",enabled:!0,mode:"select",search:{enabled:!0}},columns:l,masterDetail:t,onContentReady:(...r)=>{tippy(".tippy-here",{arrow:!0,animation:"scale"})}}).dxDataGrid("instance"),tippy(".dx-button",{arrow:!0})},[null]),e.jsx("div",{ref:i}));let j=new AbortController;class T{constructor(){m(this,"path",null);m(this,"paginate",async a=>{j.abort("Nothing"),j=new AbortController;const l=j.signal;return console.log(a),await(await fetch(`/api/${this.path}/paginate`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Xsrf-Token":decodeURIComponent(d.Cookies.get("XSRF-TOKEN"))},body:JSON.stringify(a),signal:l})).json()});m(this,"save",async a=>{try{const{status:l,result:n}=await d.Fetch(`/api/${this.path}`,{method:"POST",body:JSON.stringify(a)});if(!l)throw new Error((n==null?void 0:n.message)||"Ocurrio un error inesperado");return d.Notify.add({icon:"/img_donas/icon.svg",title:"Correcto",body:n.message,type:"success"}),n}catch(l){return d.Notify.add({icon:"/img_donas/icon.svg",title:"Error",body:l.message,type:"danger"}),null}});m(this,"status",async({id:a,status:l})=>{try{const{status:n,result:t}=await d.Fetch(`/api/${this.path}/status`,{method:"PATCH",body:JSON.stringify({id:a,status:l})});if(!n)throw new Error((t==null?void 0:t.message)??"Ocurrio un error inesperado");return d.Notify.add({icon:"/img_donas/icon.svg",title:"Correcto",body:t.message,type:"success"}),!0}catch(n){return d.Notify.add({icon:"/img_donas/icon.svg",title:"Error",body:n.message,type:"danger"}),!1}});m(this,"delete",async a=>{try{const{status:l,result:n}=await d.Fetch(`/api/${this.path}/${a}`,{method:"DELETE"});if(!l)throw new Error((n==null?void 0:n.message)??"Ocurrio un error inesperado");return d.Notify.add({icon:"/img_donas/icon.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(l){return d.Notify.add({icon:"/img_donas/icon.svg",title:"Error",body:l.message,type:"danger"}),!1}})}}class R extends T{constructor(){super(...arguments);m(this,"path","admin/sales")}}const B=({title:i,prepend:a="",gridRef:l,rest:n,columns:t,toolBar:x,masterDetail:h,filterValue:u=[],exportable:p=!1,customizeCell:r})=>e.jsx("div",{className:"flex flex-wrap",children:e.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-8 max-w-9xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow-md",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4",children:typeof i=="object"?i:e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"header-title-options",className:"float-right"}),e.jsx("span",{id:"header-title-prefix"})," Lista de ",i," ",e.jsx("span",{id:"header-title-suffix"})]})}),e.jsx(E,{exportableName:i,gridRef:l,rest:n,columns:t.filter(Boolean),toolBar:x,masterDetail:h,filterValue:u,exportable:p,customizeCell:r})]})})})}),w=(i,a)=>{const l=document.createElement("div");i.append(l),N(l).render(a)};_.setAppElement("#app");const D={content:{height:"max-content",maxHeight:"95vh",overflowY:"auto"}},v=new R,P=({statuses:i})=>{const a=g.useRef(),[l,n]=g.useState(!1),[t,x]=g.useState(null),h=r=>{n(!0),x(r)},u=()=>{n(!1),x(null)};g.useEffect(()=>{document.title="Las doñas - Ventas"});const p=async({id:r,status_id:s},c)=>{const{isConfirmed:o}=await S.fire({title:"Confirmar cambio de estado",text:"¿Está seguro de cambiar el estado de la venta?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, cambiar",cancelButtonText:"Cancelar"});if(!o){$(c).val(s);return}await v.save({id:r,status_id:c.value})&&$(a.current).dxDataGrid("instance").refresh()};return e.jsxs(e.Fragment,{children:[e.jsx(B,{gridRef:a,rest:v,exportable:!0,title:"Ventas",toolBar:r=>{r.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(a.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"created_at",caption:"Fecha pedido",visible:!1,sortOrder:"desc"},{dataField:"codigo_orden",caption:"Codigo",width:"130px",cellTemplate:(r,{data:s})=>{w(r,e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["#",s.codigo_orden]}),e.jsxs("button",{className:"text-blue-500",onClick:()=>h(s),children:["Ver pedido",e.jsx("i",{className:"mdi mdi-arrow-top-right ms-1"})]})]}))}},{dataField:"billing_name",caption:"Cliente",cellTemplate:(r,{data:s})=>{r.html(b(e.jsxs(e.Fragment,{children:[e.jsx("p",{children:s.billing_name.toTitleCase()}),e.jsx("span",{className:"text-gray-500",children:s.billing_email})]})))}},{dataField:"monto",caption:"Precio total",dataType:"number",cellTemplate:(r,{data:s})=>{r.html(b(e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["S/.",Number(s.monto).toFixed(2)]}),e.jsxs("span",{className:"text-gray-500",children:["Envío: ",s.precio_envio==0?"Gratis":`S./${Number(s.precio_envio).toFixed(2)}`]})]})))}},{dataField:"fecha_envio",caption:"Fecha envío",dataType:"datetime",format:"yyyy-MM-dd HH:mm:ss",cellTemplate:(r,{data:s})=>{var c,o;r.html(b(e.jsxs(e.Fragment,{children:[e.jsx("p",{children:moment(s.fecha_envio).format("LL")}),e.jsxs("div",{className:"text-gray-500 flex gap-1",children:[e.jsx("span",{children:"De"}),e.jsx("span",{children:moment((c=s.horario_envio)==null?void 0:c.start_time,"HH:mm:ss").format("HH:mm")}),e.jsx("span",{children:"a"}),e.jsx("span",{children:moment((o=s.horario_envio)==null?void 0:o.end_time,"HH:mm:ss").format("HH:mm")})]})]})))}},{dataField:"status_ordenes.name",caption:"Estado",width:"175px",cellTemplate:(r,{data:s})=>{w(r,e.jsx(e.Fragment,{children:e.jsx("select",{className:"block w-full p-2 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",onChange:c=>p(s,c.target),defaultValue:s.status_ordenes.id,children:i.map(({id:c,name:o})=>e.jsx("option",{value:c,children:o},c))})}))}}],customizeCell:r=>{var s,c,o,f,y;((s=r==null?void 0:r.gridCell)==null?void 0:s.rowType)=="data"&&!((c=r==null?void 0:r.gridCell)!=null&&c.value)?r.gridCell.column.dataField==="sale.address_district"&&(r.excelCell.value="- Sin distrito -",r.excelCell.font={italic:!0}):((o=r==null?void 0:r.gridCell)==null?void 0:o.rowType)=="data"&&r.gridCell.column.dataField==="product_name"?(r.excelCell.value=html2string(r.excelCell.value.replaceAll("</b><ul",`</b>
<ul`).replaceAll("</li><li",`</li>
<li`)),r.excelCell.alignment={wrapText:!0}):((f=r==null?void 0:r.gridCell)==null?void 0:f.rowType)=="data"&&r.gridCell.column.dataField==="price"?(r.excelCell.numFmt="0.00",r.excelCell.alignment={horizontal:"right"}):((y=r==null?void 0:r.gridCell)==null?void 0:y.rowType)=="data"&&r.gridCell.column.dataField==="sale.name"&&(r.excelCell.value=`${r.gridCell.data.sale.name} ${r.gridCell.data.sale.lastname}`)}}),e.jsx(_,{isOpen:l,onRequestClose:u,className:"max-w-4xl mx-auto mt-10 bg-white p-6 rounded-lg shadow-xl",overlayClassName:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4",style:D,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800",children:["Pedido #",t==null?void 0:t.codigo_orden]}),e.jsx("button",{onClick:u,className:"text-gray-600 hover:text-gray-800",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Información del Cliente"}),e.jsxs("div",{className:"px-4 flex items-center gap-2 py-3 text-sm text-gray-900 rounded border shadow mb-2",children:[e.jsx("img",{className:"h-10 w-10 flex-shrink-0 object-cover object-center rounded-full",src:`/storage/${t==null?void 0:t.usuario_pedido.profile_photo_path}`,alt:`Perfil de ${t==null?void 0:t.usuario_pedido.name} ${(t==null?void 0:t.usuario_pedido.lastname)||""}`,onError:r=>r.target.src=`https://ui-avatars.com/api/?name=${t==null?void 0:t.usuario_pedido.name}+${(t==null?void 0:t.usuario_pedido.lastname)||""}&color=7F9CF5&background=EBF4FF`}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"font-medium truncate",children:[t==null?void 0:t.usuario_pedido.name," ",(t==null?void 0:t.usuario_pedido.lastname)||""]}),e.jsx("div",{className:"truncate text-gray-500",children:t==null?void 0:t.usuario_pedido.email})]})]}),e.jsxs("p",{children:[e.jsx("b",{children:"Celular"}),": ",t==null?void 0:t.consumer_phone]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Detalles de Facturación"}),e.jsxs("p",{children:[e.jsx("b",{children:"Documento"}),": ",(t==null?void 0:t.billing_type)=="boleta"?"DNI":"RUC"," ",t==null?void 0:t.billing_document]}),e.jsxs("p",{children:[e.jsx("b",{children:"Nombre"}),": ",t==null?void 0:t.billing_name.toTitleCase()]}),e.jsxs("p",{children:[e.jsx("b",{children:"Dirección Fiscal"}),": ",t==null?void 0:t.billing_address]}),e.jsxs("p",{children:[e.jsx("b",{children:"Correo"}),": ",t==null?void 0:t.billing_email]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Productos"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-start text-sm font-medium text-slate-800",children:"Producto"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-sm font-medium text-slate-800",children:"Precio"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-sm font-medium text-slate-800",children:"Cantidad"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-end text-sm font-medium text-slate-800",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:t==null?void 0:t.detalle_orden.map((r,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-800",children:e.jsx("div",{className:"flex flex-row items-start gap-4",children:e.jsx("img",{className:"w-10 aspect-square shadow rounded object-cover object-center",src:`/${r.imagen_producto.name_imagen}`,alt:r.producto.producto})})}),e.jsxs("td",{children:[e.jsx("h2",{className:"-mb-2",children:r.producto.producto}),r.points_used>0&&e.jsx("span",{className:"text-orange-500 text-xs",children:"Usó puntos"})]}),e.jsx("td",{className:"px-4 py-2 text-sm font-bold text-center text-gray-800",children:r.points_used>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"block",children:r.precio}),e.jsxs("span",{className:"block text-orange-500",children:[e.jsx("i",{className:"mdi mdi-dots-hexagon me-1"}),r.points]})]}):r.precio}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-800 text-center font-bold",children:r.points_used>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"block",children:r.cantidad-r.points_used/r.points}),e.jsx("span",{className:"block text-orange-500",children:r.points_used/r.points})]}):r.cantidad}),e.jsx("td",{className:"px-4 py-2 text-sm text-end font-medium text-gray-800",children:r.points_used>0?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"block",children:["S/. ",r.price_used]}),e.jsxs("span",{className:"block text-orange-500",children:[r.points_used," puntos"]})]}):`S/. ${r.price_used}`})]},s))})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Resumen del Pedido"}),e.jsxs("p",{children:["Subtotal: S/. ",Number(t==null?void 0:t.monto).toFixed(2)]}),e.jsxs("p",{children:["Costo de envío: S/. ",Number(t==null?void 0:t.precio_envio).toFixed(2)]}),e.jsxs("p",{className:"font-bold",children:["Total: S/. ",(Number(t==null?void 0:t.monto)+Number(t==null?void 0:t.precio_envio)).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Detalles del Arreglo Floral"}),(t==null?void 0:t.dedication_image)&&e.jsx("img",{src:`/${t==null?void 0:t.dedication_image}`,alt:"Arreglo Floral",className:"max-w-full max-h-40 object-cover rounded-md mb-2"}),e.jsxs("p",{children:[e.jsx("b",{children:"Mensaje"}),": ",(t==null?void 0:t.dedication_message)||e.jsx("i",{className:"text-gray-500",children:"- Sin mensaje -"})]}),e.jsxs("p",{children:[e.jsx("b",{children:"De"}),": ",(t==null?void 0:t.from)||e.jsx("i",{className:"text-gray-500",children:"- Sin de -"})]}),e.jsxs("p",{children:[e.jsx("b",{children:"Para"}),": ",(t==null?void 0:t.to)||e.jsx("i",{className:"text-gray-500",children:"- Sin para -"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Ubicación de Entrega"}),e.jsxs("p",{children:[e.jsx("b",{children:"Recibe"}),": ",t==null?void 0:t.address_owner]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("b",{children:"En"}),": ",t==null?void 0:t.address_full]}),(t==null?void 0:t.tipo_tarjeta)=="transferencia"&&e.jsx("a",{className:"underline pb-6",href:`/${t==null?void 0:t.img_transferencia}`,download:"transferencia.jpg",target:"_blank",children:" Img Transferencia"}),e.jsx("iframe",{className:"w-full aspect-video rounded-md",src:`https://www.google.com/maps/embed/v1/place?key=AIzaSyDlQ6Bt-B5Y-rS-zVInsX_uQ0Brt8Sk6jQ&q=${t==null?void 0:t.address_latitude},${t==null?void 0:t.address_longitude}&zoom=16&maptype=satellite`,style:{border:0},allowfullscreen:"",loading:"lazy",referrerpolicy:"no-referrer-when-downgrade"})]})]})})]})};k((i,a)=>{N(i).render(e.jsx(P,{...a}))});
