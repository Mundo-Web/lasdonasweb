import{j as s}from"./Example-zgwdEd5i.js";import{r as h,R as I}from"./useOutsideClick-TT1qJ6UJ.js";import{a as K}from"./axios-_sX4vCAy.js";import{s as q}from"./storage-zp2nPsZU.js";import{S as W}from"./Profile-6kVS_QzG.js";import{t as Z}from"./tippy.esm-vXDZ6XwW.js";import{r as V}from"./index-38suPYpT.js";const ee=async(t,e=!1)=>{try{const r=await K.post("/api/products/addComplemento",{id:t});if(r.status===200){const{data:o}=r.data;let n=o.map(i=>{var u;const c={id:i.id,producto:i.producto,precio:i.descuento>0?i.descuento:i.precio,imagen:((u=i.images.filter(g=>g.caratula===1)[0])==null?void 0:u.name_imagen)??"/images/img/noimagen.jpg",cantidad:1,sku:i.sku,tipo:"Complemento",fecha:"",horario:"",extract:i.extract};return i.tipo_servicio=="complemento"&&i.puntos_complemento>0&&(c.points=i.puntos_complemento,c.usePoints=e),c}),a=q.Local.get("carrito")??[];a.some(i=>i.id===n[0].id)?a=a.map(i=>i.id===n[0].id?{...i,cantidad:i.cantidad+Number(n[0].cantidad)}:i):a=[...a,n[0]],q.Local.set("carrito",a);const d=document.getElementById("open-cart"),f=$("#gift-icon");return f.addClass("send-to-cart"),setTimeout(()=>{f.removeClass("send-to-cart"),f.removeAttr("style"),limpiarHTML(),PintarCarrito(),$(d).addClass("shake"),setTimeout(function(){$(d).removeClass("shake")},1e3)},1e3),a}}catch(r){console.error(r),Swal.fire({icon:"error",title:"Error",text:"Hubo un error al agregar el pedido. Por favor, int√©ntelo de nuevo."})}};function J(t,e){if(t==null)return{};var r={},o=Object.keys(t),n,a;for(a=0;a<o.length;a++)n=o[a],!(e.indexOf(n)>=0)&&(r[n]=t[n]);return r}var Q=typeof window<"u"&&typeof document<"u";function D(t,e){t&&(typeof t=="function"&&t(e),{}.hasOwnProperty.call(t,"current")&&(t.current=e))}function U(){return Q&&document.createElement("div")}function te(t){var e={"data-placement":t.placement};return t.referenceHidden&&(e["data-reference-hidden"]=""),t.escaped&&(e["data-escaped"]=""),e}function X(t,e){if(t===e)return!0;if(typeof t=="object"&&t!=null&&typeof e=="object"&&e!=null){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var r in t)if(e.hasOwnProperty(r)){if(!X(t[r],e[r]))return!1}else return!1;return!0}else return!1}function re(t){var e=[];return t.forEach(function(r){e.find(function(o){return X(r,o)})||e.push(r)}),e}function ne(t,e){var r,o;return Object.assign({},e,{popperOptions:Object.assign({},t.popperOptions,e.popperOptions,{modifiers:re([].concat(((r=t.popperOptions)==null?void 0:r.modifiers)||[],((o=e.popperOptions)==null?void 0:o.modifiers)||[]))})})}var A=Q?h.useLayoutEffect:h.useEffect;function oe(t){var e=h.useRef();return e.current||(e.current=typeof t=="function"?t():t),e.current}function z(t,e,r){r.split(/\s+/).forEach(function(o){o&&t.classList[e](o)})}var ae={name:"className",defaultValue:"",fn:function(e){var r=e.popper.firstElementChild,o=function(){var d;return!!((d=e.props.render)!=null&&d.$$tippy)};function n(){e.props.className&&!o()||z(r,"add",e.props.className)}function a(){o()&&z(r,"remove",e.props.className)}return{onCreate:n,onBeforeUpdate:a,onAfterUpdate:n}}};function se(t){function e(r){var o=r.children,n=r.content,a=r.visible,p=r.singleton,d=r.render,f=r.reference,i=r.disabled,c=i===void 0?!1:i,u=r.ignoreAttributes,g=u===void 0?!0:u;r.__source,r.__self;var b=J(r,["children","content","visible","singleton","render","reference","disabled","ignoreAttributes","__source","__self"]),E=a!==void 0,O=p!==void 0,_=h.useState(!1),v=_[0],C=_[1],w=h.useState({}),m=w[0],N=w[1],F=h.useState(),Y=F[0],T=F[1],x=oe(function(){return{container:U(),renders:1}}),k=Object.assign({ignoreAttributes:g},b,{content:x.container});E&&(k.trigger="manual",k.hideOnClick=!1),O&&(c=!0);var L=k,H=k.plugins||[];d&&(L=Object.assign({},k,{plugins:O&&p.data!=null?[].concat(H,[{fn:function(){return{onTrigger:function(B,P){var R=p.data.children.find(function(S){var y=S.instance;return y.reference===P.currentTarget});B.state.$$activeSingletonInstance=R.instance,T(R.content)}}}}]):H,render:function(){return{popper:x.container}}}));var M=[f].concat(o?[o.type]:[]);return A(function(){var j=f;f&&f.hasOwnProperty("current")&&(j=f.current);var l=t(j||x.ref||U(),Object.assign({},L,{plugins:[ae].concat(k.plugins||[])}));return x.instance=l,c&&l.disable(),a&&l.show(),O&&p.hook({instance:l,content:n,props:L,setSingletonContent:T}),C(!0),function(){l.destroy(),p==null||p.cleanup(l)}},M),A(function(){var j;if(x.renders===1){x.renders++;return}var l=x.instance;l.setProps(ne(l.props,L)),(j=l.popperInstance)==null||j.forceUpdate(),c?l.disable():l.enable(),E&&(a?l.show():l.hide()),O&&p.hook({instance:l,content:n,props:L,setSingletonContent:T})}),A(function(){var j;if(d){var l=x.instance;l.setProps({popperOptions:Object.assign({},l.props.popperOptions,{modifiers:[].concat((((j=l.props.popperOptions)==null?void 0:j.modifiers)||[]).filter(function(B){var P=B.name;return P!=="$$tippyReact"}),[{name:"$$tippyReact",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(P){var R,S=P.state,y=(R=S.modifiersData)==null?void 0:R.hide;(m.placement!==S.placement||m.referenceHidden!==(y==null?void 0:y.isReferenceHidden)||m.escaped!==(y==null?void 0:y.hasPopperEscaped))&&N({placement:S.placement,referenceHidden:y==null?void 0:y.isReferenceHidden,escaped:y==null?void 0:y.hasPopperEscaped}),S.attributes.popper={}}}])})})}},[m.placement,m.referenceHidden,m.escaped].concat(M)),I.createElement(I.Fragment,null,o?h.cloneElement(o,{ref:function(l){x.ref=l,D(o.ref,l)}}):null,v&&V.createPortal(d?d(te(m),Y,x.instance):n,x.container))}return e}var ie=function(t,e){return h.forwardRef(function(o,n){var a=o.children,p=J(o,["children"]);return I.createElement(t,Object.assign({},e,p),a?h.cloneElement(a,{ref:function(f){D(n,f),D(a.ref,f)}}):null)})},ce=ie(se(Z));const G=ce,le=({onChange:t,...e})=>{const o=(Local.get("carrito")??[]).findIndex(n=>n.id==e.id)!=-1;return s.jsxs("div",{className:"m-auto w-full max-w-48",children:[s.jsx("label",{htmlFor:`react-option-${e.id}`,className:"flex items-center justify-between bg-white rounded-lg cursor-pointer shadow-md border w-full",children:s.jsxs("div",{className:"block w-full relative z-0",children:[s.jsx("input",{type:"checkbox",id:`react-option-${e.id}`,name:"complementos[]",className:`peer absolute top-3 left-3 w-5 h-5 border-orange-400  accent-rosalasdonasborder-orange-400 checked:border-orange-400  outline-orange-400 checked:bg-orange-400 hover:checked:bg-orange-400 hover:border-orange-400 hover:bg-orange-400
                               focus:border-orange-400 rounded-md shadow-md focus:checked:bg-orange-400 focus:checked:border-orange-400  focus:bg-orange-400`,required:!0,defaultChecked:o,onChange:n=>t(n,e.id,e)}),e.images.length>0?e.images.map(n=>n.caratula===1?s.jsx("img",{className:"w-full aspect-square rounded-lg object-cover",src:n.name_imagen?`/${n.name_imagen}`:"/images/img/noimagen.jpg",alt:e.producto},n.id):null):s.jsx("img",{className:"w-full aspect-square rounded-lg object-cover",src:"/images/img/noimagen.jpg",alt:"No imagen"}),e.puntos_complemento>0&&s.jsx(G,{content:`Tambien puedes cambiarlo por ${e.puntos_complemento} puntos`,children:s.jsxs("span",{className:"absolute bg-orange-400 right-2 bottom-2 text-sm px-2 pt-[2px] rounded-md text-white",children:[s.jsx("i",{className:"mdi mdi-dots-hexagon me-1"}),s.jsx("span",{children:e.puntos_complemento})]})})]})}),s.jsx(G,{content:e.producto,children:s.jsx("h2",{className:"text-base font-normal text-black text-center truncate w-full mt-2 mb-1",children:e.producto})}),s.jsx("div",{className:"flex items-center font-medium justify-center gap-3",children:e.descuento>0?s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"line-through text-gray-400 text-xs sm:text-sm",children:["S/ ",s.jsx("span",{children:Number(e.precio).toFixed(0)})]}),s.jsxs("p",{children:["S/ ",Number(e.descuento).toFixed(0)]})]}):s.jsxs("p",{children:["S/ ",Number(e.precio).toFixed(0)]})})]})},de=t=>{console.log("entreo aca");let e=Local.get("carrito")||[],r={},o=[];e.forEach(n=>{r[n.id]?r[n.id]++:r[n.id]=1});for(let n in r)r[n]>1&&o.push(n);if(o.length>0){let n=e.findIndex(a=>a.id===t);n>-1&&e.splice(n,1)}else e=e.filter(n=>n.id!==t);return Local.set("carrito",e),limpiarHTML(),PintarCarrito(),e},ue=t=>{let r=(Local.get("carrito")||[]).map(o=>(o.id===t&&o.cantidad>0&&(o.cantidad-=1),o));return Local.set("carrito",r),limpiarHTML(),PintarCarrito(),r},pe=({id:t,setDetallePedido:e,onChange:r,setCarrito:o=()=>{},detallePedido:n,vcomplementos:a})=>{const[p,d]=h.useState([]),[f,i]=h.useState(!0);if(h.useEffect(()=>{(async()=>{try{const g=await K.post("/buscaSubComplementosDetalle",{id:t});d(g.data.productos),i(!1)}catch(g){console.error("Error fetching data:",g),i(!1)}})()},[t]),f)return s.jsx("div",{children:"Loading..."});const c=async(u,g,b)=>{var _;const E=Number($('[data-id="txt-user-points"]').text())||0;if(console.log(b),(Local.get("carrito")??[]).length>0)if(console.log("entro aca 1"),u.target.checked){let v=!1;E>=b.puntos_complemento&&b.puntos_complemento>0&&(v=(await W.fire({title:"Deseas intercambiarlo con puntos?",text:"Si, usar puntos",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",confirmButtonColor:"#336234",cancelButtonColor:"#EF4444"})).isConfirmed);let C=await ee(g,v);o(C)}else{ue(g);let v=Local.get("carrito").find(C=>C.id===g).cantidad;if(console.log(v),v==0){let C=de(g);console.log(C),o(C)}}else{console.log("entro aca 2");const v=structuredClone(n),C=(_=v.complementos)==null?void 0:_.findIndex(m=>m.id===g);let w={};if(C===-1){let m=!1;E>=b.puntos_complemento&&b.puntos_complemento>0&&(m=(await W.fire({title:"Deseas intercambiarlo con puntos?",text:"Si, usar puntos",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",confirmButtonColor:"#336234",cancelButtonColor:"#EF4444"})).isConfirmed),w={...v,complementos:[...v.complementos,{...b,usePoints:m}]};let N=Number(b.descuento>0?b.descuento:b.precio);console.log(Number(N),a.current),a.current=Number(N)+a.current}else{let m=Number(b.descuento>0?b.descuento:b.precio);console.log(Number(m),a.current),a.current=a.current-Number(m),w={...v,complementos:v.complementos.filter(N=>N.id!==g)}}e(w)}};return s.jsx("div",{className:"grid w-full gap-4 grid-cols-1 md:grid-cols-4 mt-6",children:p.map((u,g)=>s.jsx(le,{...u,onChange:c},g))})},je=({datos:t,setDetallePedido:e,setCarrito:r=()=>{},vcomplementos:o,detallePedido:n=[]})=>{const[a,p]=h.useState(null),[d,f]=h.useState([]),i=c=>{a===c?p(null):(p(c),d.includes(c)||f([...d,c]))};return h.useEffect(()=>{i(0)},[null]),s.jsx("div",{children:t.map((c,u)=>s.jsxs("div",{className:"mt-3",children:[s.jsx("h2",{id:`accordion-collapse-heading-${c.id}`,className:"gap-4 flex flex-col",children:s.jsxs("button",{className:`flex items-center justify-between w-full p-5 font-medium rounded-t-xl  dark:focus:ring-gray-800 dark:border-gray-700 dark:text-black hover:bg-gray-100 bg-[#F8F8F8] dark:hover:bg-gray-800 gap-3 ${a===u?"bg-[#FF8555] text-white":"text-black rounded-b-xl"}`,"data-accordion-target":`#accordion-collapse-body-${c.id}`,"aria-expanded":a===u,"aria-controls":`accordion-collapse-body-${c.id}`,type:"button",style:{transition:"all 500ms ease-in-out"},onClick:()=>i(u),children:[s.jsx("span",{children:c.name}),s.jsx("svg",{"data-accordion-icon":"",className:`w-3 h-3 shrink-0 ${a===u?"stroke-[#FF8555]":"rotate-180 text-[#FF8555]"} `,fill:"none",viewBox:"0 0 10 6",children:s.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5 5 1 1 5"})})]})}),s.jsx("div",{id:`accordion-collapse-body-${c.id}`,className:`${a===u?"":"hidden"}`,"aria-labelledby":`accordion-collapse-heading-${c.id}`,children:s.jsx("div",{className:"p-5 border border-gray-200 dark:border-gray-700 dark:bg-gray-900 rounded-b-xl",children:d.includes(u)&&s.jsx(pe,{id:c.id,setDetallePedido:e,detallePedido:n,setCarrito:r,vcomplementos:o})})})]},c.id))})};export{je as A,le as C,G as T,ee as a,de as b,ue as d};
