import{j as s}from"./Example-zgwdEd5i.js";import{r as f,R}from"./useOutsideClick-TT1qJ6UJ.js";import{a as G}from"./axios-_sX4vCAy.js";import{s as M}from"./storage-zp2nPsZU.js";import{S as q}from"./Profile-6kVS_QzG.js";import{t as Z}from"./tippy.esm-vXDZ6XwW.js";import{r as V}from"./index-38suPYpT.js";const ee=async(t,e=!1)=>{try{const r=await G.post("/api/products/addComplemento",{id:t});if(r.status===200){const{data:o}=r.data;let n=o.map(a=>{var h;const d={id:a.id,producto:a.producto,precio:a.descuento>0?a.descuento:a.precio,imagen:((h=a.images.filter(w=>w.caratula===1)[0])==null?void 0:h.name_imagen)??"/images/img/noimagen.jpg",cantidad:1,sku:a.sku,tipo:"Complemento",fecha:"",horario:"",extract:a.extract};return a.tipo_servicio=="complemento"&&a.puntos_complemento>0&&(d.points=a.puntos_complemento,d.usePoints=e),d}),i=M.Local.get("carrito")??[];i.some(a=>a.id===n[0].id)?i=i.map(a=>a.id===n[0].id?{...a,cantidad:a.cantidad+Number(n[0].cantidad)}:a):i=[...i,n[0]],M.Local.set("carrito",i);const u=document.getElementById("open-cart"),c=$("#gift-icon");return c.addClass("send-to-cart"),setTimeout(()=>{c.removeClass("send-to-cart"),c.removeAttr("style"),limpiarHTML(),PintarCarrito(),$(u).addClass("shake"),setTimeout(function(){$(u).removeClass("shake")},1e3)},1e3),i}}catch(r){console.error(r),Swal.fire({icon:"error",title:"Error",text:"Hubo un error al agregar el pedido. Por favor, int√©ntelo de nuevo."})}};function K(t,e){if(t==null)return{};var r={},o=Object.keys(t),n,i;for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&(r[n]=t[n]);return r}var J=typeof window<"u"&&typeof document<"u";function B(t,e){t&&(typeof t=="function"&&t(e),{}.hasOwnProperty.call(t,"current")&&(t.current=e))}function W(){return J&&document.createElement("div")}function te(t){var e={"data-placement":t.placement};return t.referenceHidden&&(e["data-reference-hidden"]=""),t.escaped&&(e["data-escaped"]=""),e}function Q(t,e){if(t===e)return!0;if(typeof t=="object"&&t!=null&&typeof e=="object"&&e!=null){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var r in t)if(e.hasOwnProperty(r)){if(!Q(t[r],e[r]))return!1}else return!1;return!0}else return!1}function re(t){var e=[];return t.forEach(function(r){e.find(function(o){return Q(r,o)})||e.push(r)}),e}function ne(t,e){var r,o;return Object.assign({},e,{popperOptions:Object.assign({},t.popperOptions,e.popperOptions,{modifiers:re([].concat(((r=t.popperOptions)==null?void 0:r.modifiers)||[],((o=e.popperOptions)==null?void 0:o.modifiers)||[]))})})}var P=J?f.useLayoutEffect:f.useEffect;function oe(t){var e=f.useRef();return e.current||(e.current=typeof t=="function"?t():t),e.current}function U(t,e,r){r.split(/\s+/).forEach(function(o){o&&t.classList[e](o)})}var ae={name:"className",defaultValue:"",fn:function(e){var r=e.popper.firstElementChild,o=function(){var u;return!!((u=e.props.render)!=null&&u.$$tippy)};function n(){e.props.className&&!o()||U(r,"add",e.props.className)}function i(){o()&&U(r,"remove",e.props.className)}return{onCreate:n,onBeforeUpdate:i,onAfterUpdate:n}}};function se(t){function e(r){var o=r.children,n=r.content,i=r.visible,p=r.singleton,u=r.render,c=r.reference,a=r.disabled,d=a===void 0?!1:a,h=r.ignoreAttributes,w=h===void 0?!0:h;r.__source,r.__self;var F=K(r,["children","content","visible","singleton","render","reference","disabled","ignoreAttributes","__source","__self"]),m=i!==void 0,g=p!==void 0,C=f.useState(!1),j=C[0],T=C[1],A=f.useState({}),y=A[0],X=A[1],I=f.useState(),Y=I[0],L=I[1],b=oe(function(){return{container:W(),renders:1}}),k=Object.assign({ignoreAttributes:w},F,{content:b.container});m&&(k.trigger="manual",k.hideOnClick=!1),g&&(d=!0);var S=k,D=k.plugins||[];u&&(S=Object.assign({},k,{plugins:g&&p.data!=null?[].concat(D,[{fn:function(){return{onTrigger:function(_,E){var O=p.data.children.find(function(N){var x=N.instance;return x.reference===E.currentTarget});_.state.$$activeSingletonInstance=O.instance,L(O.content)}}}}]):D,render:function(){return{popper:b.container}}}));var H=[c].concat(o?[o.type]:[]);return P(function(){var v=c;c&&c.hasOwnProperty("current")&&(v=c.current);var l=t(v||b.ref||W(),Object.assign({},S,{plugins:[ae].concat(k.plugins||[])}));return b.instance=l,d&&l.disable(),i&&l.show(),g&&p.hook({instance:l,content:n,props:S,setSingletonContent:L}),T(!0),function(){l.destroy(),p==null||p.cleanup(l)}},H),P(function(){var v;if(b.renders===1){b.renders++;return}var l=b.instance;l.setProps(ne(l.props,S)),(v=l.popperInstance)==null||v.forceUpdate(),d?l.disable():l.enable(),m&&(i?l.show():l.hide()),g&&p.hook({instance:l,content:n,props:S,setSingletonContent:L})}),P(function(){var v;if(u){var l=b.instance;l.setProps({popperOptions:Object.assign({},l.props.popperOptions,{modifiers:[].concat((((v=l.props.popperOptions)==null?void 0:v.modifiers)||[]).filter(function(_){var E=_.name;return E!=="$$tippyReact"}),[{name:"$$tippyReact",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(E){var O,N=E.state,x=(O=N.modifiersData)==null?void 0:O.hide;(y.placement!==N.placement||y.referenceHidden!==(x==null?void 0:x.isReferenceHidden)||y.escaped!==(x==null?void 0:x.hasPopperEscaped))&&X({placement:N.placement,referenceHidden:x==null?void 0:x.isReferenceHidden,escaped:x==null?void 0:x.hasPopperEscaped}),N.attributes.popper={}}}])})})}},[y.placement,y.referenceHidden,y.escaped].concat(H)),R.createElement(R.Fragment,null,o?f.cloneElement(o,{ref:function(l){b.ref=l,B(o.ref,l)}}):null,j&&V.createPortal(u?u(te(y),Y,b.instance):n,b.container))}return e}var ie=function(t,e){return f.forwardRef(function(o,n){var i=o.children,p=K(o,["children"]);return R.createElement(t,Object.assign({},e,p),i?f.cloneElement(i,{ref:function(c){B(n,c),B(i.ref,c)}}):null)})},ce=ie(se(Z));const z=ce,le=({onChange:t,...e})=>{const o=(Local.get("carrito")??[]).findIndex(n=>n.id==e.id)!=-1;return s.jsxs("div",{className:"m-auto w-full max-w-48",children:[s.jsx("label",{htmlFor:`react-option-${e.id}`,className:"flex items-center justify-between bg-white rounded-lg cursor-pointer shadow-md border w-full",children:s.jsxs("div",{className:"block w-full relative z-0",children:[s.jsx("input",{type:"checkbox",id:`react-option-${e.id}`,name:"complementos[]",className:`peer absolute top-3 left-3 w-5 h-5 border-orange-400  accent-rosalasdonasborder-orange-400 checked:border-orange-400  outline-orange-400 checked:bg-orange-400 hover:checked:bg-orange-400 hover:border-orange-400 hover:bg-orange-400
                               focus:border-orange-400 rounded-md shadow-md focus:checked:bg-orange-400 focus:checked:border-orange-400  focus:bg-orange-400`,required:!0,defaultChecked:o,onChange:n=>t(n,e.id,e)}),e.images.length>0?e.images.map(n=>n.caratula===1?s.jsx("img",{className:"w-full aspect-square rounded-lg object-cover",src:n.name_imagen?`/${n.name_imagen}`:"/images/img/noimagen.jpg",alt:e.producto},n.id):null):s.jsx("img",{className:"w-full aspect-square rounded-lg object-cover",src:"/images/img/noimagen.jpg",alt:"No imagen"}),e.puntos_complemento>0&&s.jsx(z,{content:`Tambien puedes cambiarlo por ${e.puntos_complemento} puntos`,children:s.jsxs("span",{className:"absolute bg-orange-400 right-2 bottom-2 text-sm px-2 pt-[2px] rounded-md text-white",children:[s.jsx("i",{className:"mdi mdi-dots-hexagon me-1"}),s.jsx("span",{children:e.puntos_complemento})]})})]})}),s.jsx(z,{content:e.producto,children:s.jsx("h2",{className:"text-base font-normal text-black text-center truncate w-full mt-2 mb-1",children:e.producto})}),s.jsx("div",{className:"flex items-center font-medium justify-center gap-3",children:e.descuento>0?s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"line-through text-gray-400 text-xs sm:text-sm",children:["S/ ",s.jsx("span",{children:Number(e.precio).toFixed(0)})]}),s.jsxs("p",{children:["S/ ",Number(e.descuento).toFixed(0)]})]}):s.jsxs("p",{children:["S/ ",Number(e.precio).toFixed(0)]})})]})},de=t=>{console.log("entreo aca");let e=Local.get("carrito")||[],r={},o=[];e.forEach(n=>{r[n.id]?r[n.id]++:r[n.id]=1});for(let n in r)r[n]>1&&o.push(n);if(o.length>0){let n=e.findIndex(i=>i.id===t);n>-1&&e.splice(n,1)}else e=e.filter(n=>n.id!==t);return Local.set("carrito",e),limpiarHTML(),PintarCarrito(),e},ue=t=>{let r=(Local.get("carrito")||[]).map(o=>(o.id===t&&o.cantidad>0&&(o.cantidad-=1),o));return Local.set("carrito",r),limpiarHTML(),PintarCarrito(),r},pe=({id:t,setDetallePedido:e,onChange:r,setCarrito:o=()=>{}})=>{const[n,i]=f.useState([]),[p,u]=f.useState(!0);if(f.useEffect(()=>{(async()=>{try{const d=await G.post("/buscaSubComplementosDetalle",{id:t});i(d.data.productos),u(!1)}catch(d){console.error("Error fetching data:",d),u(!1)}})()},[t]),p)return s.jsx("div",{children:"Loading..."});const c=async(a,d,h)=>{const w=Number($('[data-id="txt-user-points"]').text())||0;if((Local.get("carrito")??[]).length>0)if(a.target.checked){let m=!1;w>=h.puntos_complemento&&h.puntos_complemento>0&&(m=(await q.fire({title:"Deseas intercambiarlo con puntos?",text:"Si, usar puntos",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",confirmButtonColor:"#336234",cancelButtonColor:"#EF4444"})).isConfirmed);let g=await ee(d,m);o(g)}else{ue(d);let m=Local.get("carrito").find(g=>g.id===d).cantidad;if(console.log(m),m==0){let g=de(d);console.log(g),o(g)}}else{const m=structuredClone(detallePedido),g=m.complementos.findIndex(j=>j.id===d);let C={};if(g===-1){let j=!1;w>=h.puntos_complemento&&h.puntos_complemento>0&&(j=(await q.fire({title:"Deseas intercambiarlo con puntos?",text:"Si, usar puntos",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",confirmButtonColor:"#336234",cancelButtonColor:"#EF4444"})).isConfirmed),C={...m,complementos:[...m.complementos,{...h,usePoints:j}]}}else C={...m,complementos:m.complementos.filter(j=>j.id!==d)};e(C)}};return s.jsx("div",{className:"grid w-full gap-4 grid-cols-1 md:grid-cols-4 mt-6",children:n.map((a,d)=>s.jsx(le,{...a,onChange:c},d))})},je=({datos:t,setDetallePedido:e,setCarrito:r=()=>{}})=>{const[o,n]=f.useState(null),[i,p]=f.useState([]),u=c=>{o===c?n(null):(n(c),i.includes(c)||p([...i,c]))};return f.useEffect(()=>{u(0)},[null]),s.jsx("div",{children:t.map((c,a)=>s.jsxs("div",{className:"mt-3",children:[s.jsx("h2",{id:`accordion-collapse-heading-${c.id}`,className:"gap-4 flex flex-col",children:s.jsxs("button",{className:`flex items-center justify-between w-full p-5 font-medium rounded-t-xl  dark:focus:ring-gray-800 dark:border-gray-700 dark:text-black hover:bg-gray-100 bg-[#F8F8F8] dark:hover:bg-gray-800 gap-3 ${o===a?"bg-[#FF8555] text-white":"text-black rounded-b-xl"}`,"data-accordion-target":`#accordion-collapse-body-${c.id}`,"aria-expanded":o===a,"aria-controls":`accordion-collapse-body-${c.id}`,type:"button",style:{transition:"all 500ms ease-in-out"},onClick:()=>u(a),children:[s.jsx("span",{children:c.name}),s.jsx("svg",{"data-accordion-icon":"",className:`w-3 h-3 shrink-0 ${o===a?"stroke-[#FF8555]":"rotate-180 text-[#FF8555]"} `,fill:"none",viewBox:"0 0 10 6",children:s.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5 5 1 1 5"})})]})}),s.jsx("div",{id:`accordion-collapse-body-${c.id}`,className:`${o===a?"":"hidden"}`,"aria-labelledby":`accordion-collapse-heading-${c.id}`,children:s.jsx("div",{className:"p-5 border border-gray-200 dark:border-gray-700 dark:bg-gray-900 rounded-b-xl",children:i.includes(a)&&s.jsx(pe,{id:c.id,setDetallePedido:e,setCarrito:r})})})]},c.id))})};export{je as A,le as C,z as T,ee as a,de as b,ue as d};
