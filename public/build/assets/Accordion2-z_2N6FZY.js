import{j as a}from"./Example-zgwdEd5i.js";import{r as p,R}from"./useOutsideClick-TT1qJ6UJ.js";import{a as z}from"./axios-_sX4vCAy.js";import{s as H}from"./storage-zp2nPsZU.js";import{S as M}from"./Profile-6kVS_QzG.js";import{t as Z}from"./tippy.esm-vXDZ6XwW.js";import{r as V}from"./index-38suPYpT.js";const ee=async(t,e=!1)=>{try{const r=await z.post("/api/products/addComplemento",{id:t});if(r.status===200){const{data:n}=r.data;let o=n.map(s=>{var x;const f={id:s.id,producto:s.producto,precio:s.descuento>0?s.descuento:s.precio,imagen:((x=s.images.filter(E=>E.caratula===1)[0])==null?void 0:x.name_imagen)??"/images/img/noimagen.jpg",cantidad:1,sku:s.sku,tipo:"Complemento",fecha:"",horario:"",extract:s.extract};return s.tipo_servicio=="complemento"&&s.puntos_complemento>0&&(f.points=s.puntos_complemento,f.usePoints=e),f}),c=H.Local.get("carrito")??[];c.some(s=>s.id===o[0].id)?c=c.map(s=>s.id===o[0].id?{...s,cantidad:s.cantidad+Number(o[0].cantidad)}:s):c=[...c,o[0]],H.Local.set("carrito",c);const i=document.getElementById("open-cart"),l=$("#gift-icon");l.addClass("send-to-cart"),setTimeout(()=>{l.removeClass("send-to-cart"),l.removeAttr("style"),limpiarHTML(),PintarCarrito(),$(i).addClass("shake"),setTimeout(function(){$(i).removeClass("shake")},1e3)},1e3)}}catch(r){console.error(r),Swal.fire({icon:"error",title:"Error",text:"Hubo un error al agregar el pedido. Por favor, int√©ntelo de nuevo."})}};function G(t,e){if(t==null)return{};var r={},n=Object.keys(t),o,c;for(c=0;c<n.length;c++)o=n[c],!(e.indexOf(o)>=0)&&(r[o]=t[o]);return r}var K=typeof window<"u"&&typeof document<"u";function L(t,e){t&&(typeof t=="function"&&t(e),{}.hasOwnProperty.call(t,"current")&&(t.current=e))}function q(){return K&&document.createElement("div")}function te(t){var e={"data-placement":t.placement};return t.referenceHidden&&(e["data-reference-hidden"]=""),t.escaped&&(e["data-escaped"]=""),e}function J(t,e){if(t===e)return!0;if(typeof t=="object"&&t!=null&&typeof e=="object"&&e!=null){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var r in t)if(e.hasOwnProperty(r)){if(!J(t[r],e[r]))return!1}else return!1;return!0}else return!1}function re(t){var e=[];return t.forEach(function(r){e.find(function(n){return J(r,n)})||e.push(r)}),e}function ne(t,e){var r,n;return Object.assign({},e,{popperOptions:Object.assign({},t.popperOptions,e.popperOptions,{modifiers:re([].concat(((r=t.popperOptions)==null?void 0:r.modifiers)||[],((n=e.popperOptions)==null?void 0:n.modifiers)||[]))})})}var B=K?p.useLayoutEffect:p.useEffect;function oe(t){var e=p.useRef();return e.current||(e.current=typeof t=="function"?t():t),e.current}function W(t,e,r){r.split(/\s+/).forEach(function(n){n&&t.classList[e](n)})}var ae={name:"className",defaultValue:"",fn:function(e){var r=e.popper.firstElementChild,n=function(){var i;return!!((i=e.props.render)!=null&&i.$$tippy)};function o(){e.props.className&&!n()||W(r,"add",e.props.className)}function c(){n()&&W(r,"remove",e.props.className)}return{onCreate:o,onBeforeUpdate:c,onAfterUpdate:o}}};function se(t){function e(r){var n=r.children,o=r.content,c=r.visible,u=r.singleton,i=r.render,l=r.reference,s=r.disabled,f=s===void 0?!1:s,x=r.ignoreAttributes,E=x===void 0?!0:x;r.__source,r.__self;var h=G(r,["children","content","visible","singleton","render","reference","disabled","ignoreAttributes","__source","__self"]),k=c!==void 0,j=u!==void 0,b=p.useState(!1),T=b[0],Q=b[1],A=p.useState({}),C=A[0],X=A[1],F=p.useState(),Y=F[0],P=F[1],m=oe(function(){return{container:q(),renders:1}}),y=Object.assign({ignoreAttributes:E},h,{content:m.container});k&&(y.trigger="manual",y.hideOnClick=!1),j&&(f=!0);var N=y,D=y.plugins||[];i&&(N=Object.assign({},y,{plugins:j&&u.data!=null?[].concat(D,[{fn:function(){return{onTrigger:function(_,S){var O=u.data.children.find(function(w){var v=w.instance;return v.reference===S.currentTarget});_.state.$$activeSingletonInstance=O.instance,P(O.content)}}}}]):D,render:function(){return{popper:m.container}}}));var I=[l].concat(n?[n.type]:[]);return B(function(){var g=l;l&&l.hasOwnProperty("current")&&(g=l.current);var d=t(g||m.ref||q(),Object.assign({},N,{plugins:[ae].concat(y.plugins||[])}));return m.instance=d,f&&d.disable(),c&&d.show(),j&&u.hook({instance:d,content:o,props:N,setSingletonContent:P}),Q(!0),function(){d.destroy(),u==null||u.cleanup(d)}},I),B(function(){var g;if(m.renders===1){m.renders++;return}var d=m.instance;d.setProps(ne(d.props,N)),(g=d.popperInstance)==null||g.forceUpdate(),f?d.disable():d.enable(),k&&(c?d.show():d.hide()),j&&u.hook({instance:d,content:o,props:N,setSingletonContent:P})}),B(function(){var g;if(i){var d=m.instance;d.setProps({popperOptions:Object.assign({},d.props.popperOptions,{modifiers:[].concat((((g=d.props.popperOptions)==null?void 0:g.modifiers)||[]).filter(function(_){var S=_.name;return S!=="$$tippyReact"}),[{name:"$$tippyReact",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(S){var O,w=S.state,v=(O=w.modifiersData)==null?void 0:O.hide;(C.placement!==w.placement||C.referenceHidden!==(v==null?void 0:v.isReferenceHidden)||C.escaped!==(v==null?void 0:v.hasPopperEscaped))&&X({placement:w.placement,referenceHidden:v==null?void 0:v.isReferenceHidden,escaped:v==null?void 0:v.hasPopperEscaped}),w.attributes.popper={}}}])})})}},[C.placement,C.referenceHidden,C.escaped].concat(I)),R.createElement(R.Fragment,null,n?p.cloneElement(n,{ref:function(d){m.ref=d,L(n.ref,d)}}):null,T&&V.createPortal(i?i(te(C),Y,m.instance):o,m.container))}return e}var ie=function(t,e){return p.forwardRef(function(n,o){var c=n.children,u=G(n,["children"]);return R.createElement(t,Object.assign({},e,u),c?p.cloneElement(c,{ref:function(l){L(o,l),L(c.ref,l)}}):null)})},ce=ie(se(Z));const U=ce,le=({onChange:t,...e})=>{const n=(Local.get("carrito")??[]).findIndex(o=>o.id==e.id)!=-1;return a.jsxs("div",{className:"m-auto w-full max-w-48",children:[a.jsx("label",{htmlFor:`react-option-${e.id}`,className:"flex items-center justify-between bg-white rounded-lg cursor-pointer shadow-md border w-full",children:a.jsxs("div",{className:"block w-full relative z-0",children:[a.jsx("input",{type:"checkbox",id:`react-option-${e.id}`,name:"complementos[]",className:`peer absolute top-3 left-3 w-5 h-5 border-orange-400  accent-rosalasdonasborder-orange-400 checked:border-orange-400  outline-orange-400 checked:bg-orange-400 hover:checked:bg-orange-400 hover:border-orange-400 hover:bg-orange-400
                               focus:border-orange-400 rounded-md shadow-md focus:checked:bg-orange-400 focus:checked:border-orange-400  focus:bg-orange-400`,required:!0,defaultChecked:n,onChange:o=>t(o,e.id,e)}),e.images.length>0?e.images.map(o=>o.caratula===1?a.jsx("img",{className:"w-full aspect-square rounded-lg object-cover",src:o.name_imagen?`/${o.name_imagen}`:"/images/img/noimagen.jpg",alt:e.producto},o.id):null):a.jsx("img",{className:"w-full aspect-square rounded-lg object-cover",src:"/images/img/noimagen.jpg",alt:"No imagen"}),e.puntos_complemento>0&&a.jsx(U,{content:`Tambien puedes cambiarlo por ${e.puntos_complemento} puntos`,children:a.jsxs("span",{className:"absolute bg-orange-400 right-2 bottom-2 text-sm px-2 pt-[2px] rounded-md text-white",children:[a.jsx("i",{className:"mdi mdi-dots-hexagon me-1"}),a.jsx("span",{children:e.puntos_complemento})]})})]})}),a.jsx(U,{content:e.producto,children:a.jsx("h2",{className:"text-base font-normal text-black text-center truncate w-full mt-2 mb-1",children:e.producto})}),a.jsx("div",{className:"flex items-center font-medium justify-center gap-3",children:e.descuento>0?a.jsxs(a.Fragment,{children:[a.jsxs("p",{className:"line-through text-gray-400 text-xs sm:text-sm",children:["S/ ",a.jsx("span",{children:e.precio})]}),a.jsxs("p",{children:["S/ ",e.descuento]})]}):a.jsxs("p",{children:["S/ ",e.precio]})})]})},de=t=>{let r=(Local.get("carrito")||[]).map(n=>(n.id===t&&n.cantidad>0&&(n.cantidad-=1),n));return Local.set("carrito",r),limpiarHTML(),PintarCarrito(),r},ue=({id:t,setDetallePedido:e,onChange:r})=>{const[n,o]=p.useState([]),[c,u]=p.useState(!0);if(p.useEffect(()=>{(async()=>{try{const s=await z.post("/buscaSubComplementosDetalle",{id:t});o(s.data.productos),u(!1)}catch(s){console.error("Error fetching data:",s),u(!1)}})()},[t]),c)return a.jsx("div",{children:"Loading..."});const i=async(l,s,f)=>{const x=Number($('[data-id="txt-user-points"]').text())||0;if((Local.get("carrito")??[]).length>0)if(l.target.checked){let h=!1;x>=f.puntos_complemento&&f.puntos_complemento>0&&(h=(await M.fire({title:"Deseas intercambiarlo con puntos?",text:"Si, usar puntos",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",confirmButtonColor:"#336234",cancelButtonColor:"#EF4444"})).isConfirmed),ee(s,h)}else de(s);else{const h=structuredClone(detallePedido),k=h.complementos.findIndex(b=>b.id===s);let j={};if(k===-1){let b=!1;x>=f.puntos_complemento&&f.puntos_complemento>0&&(b=(await M.fire({title:"Deseas intercambiarlo con puntos?",text:"Si, usar puntos",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",confirmButtonColor:"#336234",cancelButtonColor:"#EF4444"})).isConfirmed),j={...h,complementos:[...h.complementos,{...f,usePoints:b}]}}else j={...h,complementos:h.complementos.filter(b=>b.id!==s)};e(j)}};return a.jsx("div",{className:"grid w-full gap-4 grid-cols-1 md:grid-cols-4 mt-6",children:n.map(l=>a.jsx(le,{...l,onChange:i}))})},xe=({datos:t,setDetallePedido:e})=>{const[r,n]=p.useState(null),[o,c]=p.useState([]),u=i=>{r===i?n(null):(n(i),o.includes(i)||c([...o,i]))};return p.useEffect(()=>{u(0)},[null]),a.jsx("div",{children:t.map((i,l)=>a.jsxs("div",{className:"mt-3",children:[a.jsx("h2",{id:`accordion-collapse-heading-${i.id}`,className:"gap-4 flex flex-col",children:a.jsxs("button",{className:`flex items-center justify-between w-full p-5 font-medium rounded-t-xl  dark:focus:ring-gray-800 dark:border-gray-700 dark:text-black hover:bg-gray-100 bg-[#F8F8F8] dark:hover:bg-gray-800 gap-3 ${r===l?"bg-[#FF8555] text-white":"text-black rounded-b-xl"}`,"data-accordion-target":`#accordion-collapse-body-${i.id}`,"aria-expanded":r===l,"aria-controls":`accordion-collapse-body-${i.id}`,type:"button",style:{transition:"all 500ms ease-in-out"},onClick:()=>u(l),children:[a.jsx("span",{children:i.name}),a.jsx("svg",{"data-accordion-icon":"",className:`w-3 h-3 shrink-0 ${r===l?"stroke-[#FF8555]":"rotate-180 text-[#FF8555]"} `,fill:"none",viewBox:"0 0 10 6",children:a.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5 5 1 1 5"})})]})}),a.jsx("div",{id:`accordion-collapse-body-${i.id}`,className:`${r===l?"":"hidden"}`,"aria-labelledby":`accordion-collapse-heading-${i.id}`,children:a.jsx("div",{className:"p-5 border border-gray-200 dark:border-gray-700 dark:bg-gray-900 rounded-b-xl",children:o.includes(l)&&a.jsx(ue,{id:i.id,setDetallePedido:e})})})]},i.id))})};export{xe as A,le as C,U as T,ee as a,de as d};
