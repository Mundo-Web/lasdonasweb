import{j as r}from"./Example-zgwdEd5i.js";import{r as b}from"./useOutsideClick-TT1qJ6UJ.js";import{a as L}from"./axios-_sX4vCAy.js";import{s as w}from"./storage-zp2nPsZU.js";import{S as y}from"./Profile-6kVS_QzG.js";import{T as v}from"./tippy-react.esm-xuEmYGnY.js";const F=async(u,t=!1)=>{try{const n=await L.post("/api/products/addComplemento",{id:u});if(n.status===200){const{data:i}=n.data;let a=i.map(o=>{var c;const s={id:o.id,producto:o.producto,precio:o.descuento>0?o.descuento:o.precio,imagen:((c=o.images.filter(l=>l.caratula===1)[0])==null?void 0:c.name_imagen)??"/images/img/noimagen.jpg",cantidad:1,sku:o.sku,tipo:"Complemento",fecha:"",horario:"",extract:o.extract};return o.tipo_servicio=="complemento"&&o.puntos_complemento>0&&(s.points=o.puntos_complemento,s.usePoints=t),s}),e=w.Local.get("carrito")??[];e.some(o=>o.id===a[0].id)?e=e.map(o=>o.id===a[0].id?{...o,cantidad:o.cantidad+Number(a[0].cantidad)}:o):e=[...e,a[0]],w.Local.set("carrito",e);const f=document.getElementById("open-cart"),x=$("#gift-icon");return x.addClass("send-to-cart"),setTimeout(()=>{x.removeClass("send-to-cart"),x.removeAttr("style"),limpiarHTML(),PintarCarrito(),$(f).addClass("shake"),setTimeout(function(){$(f).removeClass("shake")},1e3)},1e3),e}}catch(n){console.error(n),Swal.fire({icon:"error",title:"Error",text:"Hubo un error al agregar el pedido. Por favor, intÃ©ntelo de nuevo."})}},S=({onChange:u,...t})=>{const i=(Local.get("carrito")??[]).findIndex(e=>e.id==t.id)!=-1,a="option-"+t.id+"-"+crypto.randomUUID();return r.jsxs("div",{className:"m-auto w-full max-w-48",children:[r.jsx("label",{htmlFor:a,className:"flex items-center justify-between bg-white rounded-lg cursor-pointer shadow-md border w-full",children:r.jsxs("div",{className:"block w-full relative z-0",children:[r.jsx("input",{type:"checkbox",id:a,name:"complementos[]",className:`peer absolute top-3 left-3 w-5 h-5 border-orange-400  accent-rosalasdonasborder-orange-400 checked:border-orange-400  outline-orange-400 checked:bg-orange-400 hover:checked:bg-orange-400 hover:border-orange-400 hover:bg-orange-400
                               focus:border-orange-400 rounded-md shadow-md focus:checked:bg-orange-400 focus:checked:border-orange-400  focus:bg-orange-400`,required:!0,defaultChecked:i,onChange:e=>u(e,t.id,t)}),t.images.length>0?t.images.map(e=>e.caratula===1?r.jsx("img",{className:"w-full aspect-square rounded-lg object-cover",src:e.name_imagen?`/${e.name_imagen}`:"/images/img/noimagen.jpg",alt:t.producto},e.id):null):r.jsx("img",{className:"w-full aspect-square rounded-lg object-cover",src:"/images/img/noimagen.jpg",alt:"No imagen"}),t.puntos_complemento>0&&r.jsx(v,{content:`Tambien puedes cambiarlo por ${t.puntos_complemento} puntos`,children:r.jsxs("span",{className:"absolute bg-orange-400 right-2 bottom-2 text-sm px-2 pt-[2px] rounded-md text-white",children:[r.jsx("i",{className:"mdi mdi-dots-hexagon me-1"}),r.jsx("span",{children:t.puntos_complemento})]})})]})}),r.jsx(v,{content:t.producto,children:r.jsx("h2",{className:"text-base font-normal text-black text-center truncate w-full mt-2 mb-1",children:t.producto})}),r.jsx("div",{className:"flex items-center font-medium justify-center gap-3",children:t.descuento>0?r.jsxs(r.Fragment,{children:[r.jsxs("p",{className:"line-through text-gray-400 text-xs sm:text-sm",children:["S/ ",r.jsx("span",{children:Number(t.precio).toFixed(0)})]}),r.jsxs("p",{children:["S/ ",Number(t.descuento).toFixed(0)]})]}):r.jsxs("p",{children:["S/ ",Number(t.precio).toFixed(0)]})})]})},B=u=>{console.log("entreo aca");let t=Local.get("carrito")||[],n={},i=[];t.forEach(a=>{n[a.id]?n[a.id]++:n[a.id]=1});for(let a in n)n[a]>1&&i.push(a);if(i.length>0){let a=t.findIndex(e=>e.id===u);a>-1&&t.splice(a,1)}else t=t.filter(a=>a.id!==u);return Local.set("carrito",t),limpiarHTML(),PintarCarrito(),t},_=u=>{let n=(Local.get("carrito")||[]).map(i=>(i.id===u&&i.cantidad>0&&(i.cantidad-=1),i));return Local.set("carrito",n),limpiarHTML(),PintarCarrito(),n},T=({id:u,setDetallePedido:t,onChange:n,setCarrito:i=()=>{},detallePedido:a,vcomplementos:e})=>{const[C,f]=b.useState([]),[x,o]=b.useState(!0);if(b.useEffect(()=>{(async()=>{try{const l=await L.post("/buscaSubComplementosDetalle",{id:u});f(l.data.productos),o(!1)}catch(l){console.error("Error fetching data:",l),o(!1)}})()},[u]),x)return r.jsx("div",{children:"Loading..."});const s=async(c,l,d)=>{var N;const k=Number($('[data-id="txt-user-points"]').text())||console.log("change");if($(`[id^="option-${l}"]`).prop("checked",c.target.checked),console.log(d),(Local.get("carrito")??[]).length>0)if(console.log("entro aca 1"),c.target.checked){let g=!1;k>=d.puntos_complemento&&d.puntos_complemento>0&&(g=(await y.fire({title:"Deseas intercambiarlo con puntos?",text:"Si, usar puntos",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",confirmButtonColor:"#336234",cancelButtonColor:"#EF4444"})).isConfirmed);let h=await F(l,g);i(h)}else{_(l);let g=Local.get("carrito").find(h=>h.id===l).cantidad;if(console.log(g),g==0){let h=B(l);console.log(h),i(h)}}else{console.log("entro aca 2");const g=structuredClone(a),h=(N=g.complementos)==null?void 0:N.findIndex(p=>p.id===l);let j={};if(h===-1){let p=!1;if(k>=d.puntos_complemento&&d.puntos_complemento>0&&(p=(await y.fire({title:"Deseas intercambiarlo con puntos?",text:"Si, usar puntos",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",confirmButtonColor:"#336234",cancelButtonColor:"#EF4444"})).isConfirmed),j={...g,complementos:[...g.complementos,{...d,usePoints:p}]},c.target.checked){console.log("agregado");let m=Number(d.descuento>0?d.descuento:d.precio);console.log(Number(m),e.current),e.current=Number(m)+e.current}else{console.log("eliminado");let m=Number(d.descuento>0?d.descuento:d.precio);console.log(Number(m),e.current),e.current=e.current-Number(m)}}else{if(!c.target.checked){console.log("eliminado");let p=Number(d.descuento>0?d.descuento:d.precio);console.log(Number(p),e.current),e.current=e.current-Number(p)}j={...g,complementos:g.complementos.filter(p=>p.id!==l)}}t(j)}};return r.jsx("div",{className:"grid w-full gap-4 grid-cols-1 md:grid-cols-4 mt-6",children:C.map((c,l)=>r.jsx(S,{...c,onChange:s},l))})},M=({datos:u,setDetallePedido:t,setCarrito:n=()=>{},vcomplementos:i,detallePedido:a=[]})=>{const[e,C]=b.useState(null),[f,x]=b.useState([]),o=s=>{e===s?C(null):(C(s),f.includes(s)||x([...f,s]))};return b.useEffect(()=>{o(0)},[null]),r.jsx("div",{children:u.map((s,c)=>r.jsxs("div",{className:"mt-3",children:[r.jsx("h2",{id:`accordion-collapse-heading-${s.id}`,className:"gap-4 flex flex-col",children:r.jsxs("button",{className:`flex items-center justify-between w-full p-5 font-medium rounded-t-xl  dark:focus:ring-gray-800 dark:border-gray-700 dark:text-black hover:bg-gray-100 bg-[#F8F8F8] dark:hover:bg-gray-800 gap-3 ${e===c?"bg-[#FF8555] text-white":"text-black rounded-b-xl"}`,"data-accordion-target":`#accordion-collapse-body-${s.id}`,"aria-expanded":e===c,"aria-controls":`accordion-collapse-body-${s.id}`,type:"button",style:{transition:"all 500ms ease-in-out"},onClick:()=>o(c),children:[r.jsx("span",{children:s.name}),r.jsx("svg",{"data-accordion-icon":"",className:`w-3 h-3 shrink-0 ${e===c?"stroke-[#FF8555]":"rotate-180 text-[#FF8555]"} `,fill:"none",viewBox:"0 0 10 6",children:r.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5 5 1 1 5"})})]})}),r.jsx("div",{id:`accordion-collapse-body-${s.id}`,className:`${e===c?"":"hidden"}`,"aria-labelledby":`accordion-collapse-heading-${s.id}`,children:r.jsx("div",{className:"p-5 border border-gray-200 dark:border-gray-700 dark:bg-gray-900 rounded-b-xl",children:f.includes(c)&&r.jsx(T,{id:s.id,setDetallePedido:t,detallePedido:a,setCarrito:n,vcomplementos:i})})})]},s.id))})};export{M as A,S as C,F as a,B as b,_ as d};
