import{j as s}from"./Example-zgwdEd5i.js";import{r as b,R as A}from"./useOutsideClick-TT1qJ6UJ.js";import{a as K}from"./axios-_sX4vCAy.js";import{s as q}from"./storage-zp2nPsZU.js";import{S as U}from"./Profile-6kVS_QzG.js";import{t as Z}from"./tippy.esm-vXDZ6XwW.js";import{r as V}from"./index-38suPYpT.js";const ee=async(t,e=!1)=>{try{const n=await K.post("/api/products/addComplemento",{id:t});if(n.status===200){const{data:o}=n.data;let a=o.map(i=>{var d;const c={id:i.id,producto:i.producto,precio:i.descuento>0?i.descuento:i.precio,imagen:((d=i.images.filter(p=>p.caratula===1)[0])==null?void 0:d.name_imagen)??"/images/img/noimagen.jpg",cantidad:1,sku:i.sku,tipo:"Complemento",fecha:"",horario:"",extract:i.extract};return i.tipo_servicio=="complemento"&&i.puntos_complemento>0&&(c.points=i.puntos_complemento,c.usePoints=e),c}),r=q.Local.get("carrito")??[];r.some(i=>i.id===a[0].id)?r=r.map(i=>i.id===a[0].id?{...i,cantidad:i.cantidad+Number(a[0].cantidad)}:i):r=[...r,a[0]],q.Local.set("carrito",r);const u=document.getElementById("open-cart"),h=$("#gift-icon");return h.addClass("send-to-cart"),setTimeout(()=>{h.removeClass("send-to-cart"),h.removeAttr("style"),limpiarHTML(),PintarCarrito(),$(u).addClass("shake"),setTimeout(function(){$(u).removeClass("shake")},1e3)},1e3),r}}catch(n){console.error(n),Swal.fire({icon:"error",title:"Error",text:"Hubo un error al agregar el pedido. Por favor, int√©ntelo de nuevo."})}};function J(t,e){if(t==null)return{};var n={},o=Object.keys(t),a,r;for(r=0;r<o.length;r++)a=o[r],!(e.indexOf(a)>=0)&&(n[a]=t[a]);return n}var Q=typeof window<"u"&&typeof document<"u";function I(t,e){t&&(typeof t=="function"&&t(e),{}.hasOwnProperty.call(t,"current")&&(t.current=e))}function W(){return Q&&document.createElement("div")}function te(t){var e={"data-placement":t.placement};return t.referenceHidden&&(e["data-reference-hidden"]=""),t.escaped&&(e["data-escaped"]=""),e}function X(t,e){if(t===e)return!0;if(typeof t=="object"&&t!=null&&typeof e=="object"&&e!=null){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var n in t)if(e.hasOwnProperty(n)){if(!X(t[n],e[n]))return!1}else return!1;return!0}else return!1}function re(t){var e=[];return t.forEach(function(n){e.find(function(o){return X(n,o)})||e.push(n)}),e}function ne(t,e){var n,o;return Object.assign({},e,{popperOptions:Object.assign({},t.popperOptions,e.popperOptions,{modifiers:re([].concat(((n=t.popperOptions)==null?void 0:n.modifiers)||[],((o=e.popperOptions)==null?void 0:o.modifiers)||[]))})})}var T=Q?b.useLayoutEffect:b.useEffect;function oe(t){var e=b.useRef();return e.current||(e.current=typeof t=="function"?t():t),e.current}function z(t,e,n){n.split(/\s+/).forEach(function(o){o&&t.classList[e](o)})}var ae={name:"className",defaultValue:"",fn:function(e){var n=e.popper.firstElementChild,o=function(){var u;return!!((u=e.props.render)!=null&&u.$$tippy)};function a(){e.props.className&&!o()||z(n,"add",e.props.className)}function r(){o()&&z(n,"remove",e.props.className)}return{onCreate:a,onBeforeUpdate:r,onAfterUpdate:a}}};function se(t){function e(n){var o=n.children,a=n.content,r=n.visible,m=n.singleton,u=n.render,h=n.reference,i=n.disabled,c=i===void 0?!1:i,d=n.ignoreAttributes,p=d===void 0?!0:d;n.__source,n.__self;var f=J(n,["children","content","visible","singleton","render","reference","disabled","ignoreAttributes","__source","__self"]),E=r!==void 0,O=m!==void 0,_=b.useState(!1),v=_[0],C=_[1],k=b.useState({}),g=k[0],w=k[1],D=b.useState(),Y=D[0],F=D[1],x=oe(function(){return{container:W(),renders:1}}),N=Object.assign({ignoreAttributes:p},f,{content:x.container});E&&(N.trigger="manual",N.hideOnClick=!1),O&&(c=!0);var L=N,H=N.plugins||[];u&&(L=Object.assign({},N,{plugins:O&&m.data!=null?[].concat(H,[{fn:function(){return{onTrigger:function(B,P){var R=m.data.children.find(function(S){var y=S.instance;return y.reference===P.currentTarget});B.state.$$activeSingletonInstance=R.instance,F(R.content)}}}}]):H,render:function(){return{popper:x.container}}}));var M=[h].concat(o?[o.type]:[]);return T(function(){var j=h;h&&h.hasOwnProperty("current")&&(j=h.current);var l=t(j||x.ref||W(),Object.assign({},L,{plugins:[ae].concat(N.plugins||[])}));return x.instance=l,c&&l.disable(),r&&l.show(),O&&m.hook({instance:l,content:a,props:L,setSingletonContent:F}),C(!0),function(){l.destroy(),m==null||m.cleanup(l)}},M),T(function(){var j;if(x.renders===1){x.renders++;return}var l=x.instance;l.setProps(ne(l.props,L)),(j=l.popperInstance)==null||j.forceUpdate(),c?l.disable():l.enable(),E&&(r?l.show():l.hide()),O&&m.hook({instance:l,content:a,props:L,setSingletonContent:F})}),T(function(){var j;if(u){var l=x.instance;l.setProps({popperOptions:Object.assign({},l.props.popperOptions,{modifiers:[].concat((((j=l.props.popperOptions)==null?void 0:j.modifiers)||[]).filter(function(B){var P=B.name;return P!=="$$tippyReact"}),[{name:"$$tippyReact",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(P){var R,S=P.state,y=(R=S.modifiersData)==null?void 0:R.hide;(g.placement!==S.placement||g.referenceHidden!==(y==null?void 0:y.isReferenceHidden)||g.escaped!==(y==null?void 0:y.hasPopperEscaped))&&w({placement:S.placement,referenceHidden:y==null?void 0:y.isReferenceHidden,escaped:y==null?void 0:y.hasPopperEscaped}),S.attributes.popper={}}}])})})}},[g.placement,g.referenceHidden,g.escaped].concat(M)),A.createElement(A.Fragment,null,o?b.cloneElement(o,{ref:function(l){x.ref=l,I(o.ref,l)}}):null,v&&V.createPortal(u?u(te(g),Y,x.instance):a,x.container))}return e}var ie=function(t,e){return b.forwardRef(function(o,a){var r=o.children,m=J(o,["children"]);return A.createElement(t,Object.assign({},e,m),r?b.cloneElement(r,{ref:function(h){I(a,h),I(r.ref,h)}}):null)})},ce=ie(se(Z));const G=ce,le=({onChange:t,...e})=>{const o=(Local.get("carrito")??[]).findIndex(r=>r.id==e.id)!=-1,a="option-"+e.id+"-"+crypto.randomUUID();return s.jsxs("div",{className:"m-auto w-full max-w-48",children:[s.jsx("label",{htmlFor:a,className:"flex items-center justify-between bg-white rounded-lg cursor-pointer shadow-md border w-full",children:s.jsxs("div",{className:"block w-full relative z-0",children:[s.jsx("input",{type:"checkbox",id:a,name:"complementos[]",className:`peer absolute top-3 left-3 w-5 h-5 border-orange-400  accent-rosalasdonasborder-orange-400 checked:border-orange-400  outline-orange-400 checked:bg-orange-400 hover:checked:bg-orange-400 hover:border-orange-400 hover:bg-orange-400
                               focus:border-orange-400 rounded-md shadow-md focus:checked:bg-orange-400 focus:checked:border-orange-400  focus:bg-orange-400`,required:!0,defaultChecked:o,onChange:r=>t(r,e.id,e)}),e.images.length>0?e.images.map(r=>r.caratula===1?s.jsx("img",{className:"w-full aspect-square rounded-lg object-cover",src:r.name_imagen?`/${r.name_imagen}`:"/images/img/noimagen.jpg",alt:e.producto},r.id):null):s.jsx("img",{className:"w-full aspect-square rounded-lg object-cover",src:"/images/img/noimagen.jpg",alt:"No imagen"}),e.puntos_complemento>0&&s.jsx(G,{content:`Tambien puedes cambiarlo por ${e.puntos_complemento} puntos`,children:s.jsxs("span",{className:"absolute bg-orange-400 right-2 bottom-2 text-sm px-2 pt-[2px] rounded-md text-white",children:[s.jsx("i",{className:"mdi mdi-dots-hexagon me-1"}),s.jsx("span",{children:e.puntos_complemento})]})})]})}),s.jsx(G,{content:e.producto,children:s.jsx("h2",{className:"text-base font-normal text-black text-center truncate w-full mt-2 mb-1",children:e.producto})}),s.jsx("div",{className:"flex items-center font-medium justify-center gap-3",children:e.descuento>0?s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"line-through text-gray-400 text-xs sm:text-sm",children:["S/ ",s.jsx("span",{children:Number(e.precio).toFixed(0)})]}),s.jsxs("p",{children:["S/ ",Number(e.descuento).toFixed(0)]})]}):s.jsxs("p",{children:["S/ ",Number(e.precio).toFixed(0)]})})]})},de=t=>{console.log("entreo aca");let e=Local.get("carrito")||[],n={},o=[];e.forEach(a=>{n[a.id]?n[a.id]++:n[a.id]=1});for(let a in n)n[a]>1&&o.push(a);if(o.length>0){let a=e.findIndex(r=>r.id===t);a>-1&&e.splice(a,1)}else e=e.filter(a=>a.id!==t);return Local.set("carrito",e),limpiarHTML(),PintarCarrito(),e},ue=t=>{let n=(Local.get("carrito")||[]).map(o=>(o.id===t&&o.cantidad>0&&(o.cantidad-=1),o));return Local.set("carrito",n),limpiarHTML(),PintarCarrito(),n},pe=({id:t,setDetallePedido:e,onChange:n,setCarrito:o=()=>{},detallePedido:a,vcomplementos:r})=>{const[m,u]=b.useState([]),[h,i]=b.useState(!0);if(b.useEffect(()=>{(async()=>{try{const p=await K.post("/buscaSubComplementosDetalle",{id:t});u(p.data.productos),i(!1)}catch(p){console.error("Error fetching data:",p),i(!1)}})()},[t]),h)return s.jsx("div",{children:"Loading..."});const c=async(d,p,f)=>{var _;const E=Number($('[data-id="txt-user-points"]').text())||console.log("change");if($(`[id^="option-${p}"]`).prop("checked",d.target.checked),console.log(f),(Local.get("carrito")??[]).length>0)if(console.log("entro aca 1"),d.target.checked){let v=!1;E>=f.puntos_complemento&&f.puntos_complemento>0&&(v=(await U.fire({title:"Deseas intercambiarlo con puntos?",text:"Si, usar puntos",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",confirmButtonColor:"#336234",cancelButtonColor:"#EF4444"})).isConfirmed);let C=await ee(p,v);o(C)}else{ue(p);let v=Local.get("carrito").find(C=>C.id===p).cantidad;if(console.log(v),v==0){let C=de(p);console.log(C),o(C)}}else{console.log("entro aca 2");const v=structuredClone(a),C=(_=v.complementos)==null?void 0:_.findIndex(g=>g.id===p);let k={};if(C===-1){let g=!1;if(E>=f.puntos_complemento&&f.puntos_complemento>0&&(g=(await U.fire({title:"Deseas intercambiarlo con puntos?",text:"Si, usar puntos",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",confirmButtonColor:"#336234",cancelButtonColor:"#EF4444"})).isConfirmed),k={...v,complementos:[...v.complementos,{...f,usePoints:g}]},d.target.checked){console.log("agregado");let w=Number(f.descuento>0?f.descuento:f.precio);console.log(Number(w),r.current),r.current=Number(w)+r.current}else{console.log("eliminado");let w=Number(f.descuento>0?f.descuento:f.precio);console.log(Number(w),r.current),r.current=r.current-Number(w)}}else{if(!d.target.checked){console.log("eliminado");let g=Number(f.descuento>0?f.descuento:f.precio);console.log(Number(g),r.current),r.current=r.current-Number(g)}k={...v,complementos:v.complementos.filter(g=>g.id!==p)}}e(k)}};return s.jsx("div",{className:"grid w-full gap-4 grid-cols-1 md:grid-cols-4 mt-6",children:m.map((d,p)=>s.jsx(le,{...d,onChange:c},p))})},je=({datos:t,setDetallePedido:e,setCarrito:n=()=>{},vcomplementos:o,detallePedido:a=[]})=>{const[r,m]=b.useState(null),[u,h]=b.useState([]),i=c=>{r===c?m(null):(m(c),u.includes(c)||h([...u,c]))};return b.useEffect(()=>{i(0)},[null]),s.jsx("div",{children:t.map((c,d)=>s.jsxs("div",{className:"mt-3",children:[s.jsx("h2",{id:`accordion-collapse-heading-${c.id}`,className:"gap-4 flex flex-col",children:s.jsxs("button",{className:`flex items-center justify-between w-full p-5 font-medium rounded-t-xl  dark:focus:ring-gray-800 dark:border-gray-700 dark:text-black hover:bg-gray-100 bg-[#F8F8F8] dark:hover:bg-gray-800 gap-3 ${r===d?"bg-[#FF8555] text-white":"text-black rounded-b-xl"}`,"data-accordion-target":`#accordion-collapse-body-${c.id}`,"aria-expanded":r===d,"aria-controls":`accordion-collapse-body-${c.id}`,type:"button",style:{transition:"all 500ms ease-in-out"},onClick:()=>i(d),children:[s.jsx("span",{children:c.name}),s.jsx("svg",{"data-accordion-icon":"",className:`w-3 h-3 shrink-0 ${r===d?"stroke-[#FF8555]":"rotate-180 text-[#FF8555]"} `,fill:"none",viewBox:"0 0 10 6",children:s.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5 5 1 1 5"})})]})}),s.jsx("div",{id:`accordion-collapse-body-${c.id}`,className:`${r===d?"":"hidden"}`,"aria-labelledby":`accordion-collapse-heading-${c.id}`,children:s.jsx("div",{className:"p-5 border border-gray-200 dark:border-gray-700 dark:bg-gray-900 rounded-b-xl",children:u.includes(d)&&s.jsx(pe,{id:c.id,setDetallePedido:e,detallePedido:a,setCarrito:n,vcomplementos:o})})})]},c.id))})};export{je as A,le as C,G as T,ee as a,de as b,ue as d};
